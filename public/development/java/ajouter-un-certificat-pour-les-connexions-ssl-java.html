<!DOCTYPE html>
<html>
  <head>
    <title>
    Ajouter un certificat pour les connexions SSL Java - wiki.ght1pc9kc.fr
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40.2" />
<title>Ajouter un certificat pour les connexions SSL Java :: wiki.ght1pc9kc.fr</title>
<link rel="shortcut icon" href="/images/logo.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "";
</script>
  </head>
  <body data-url="/development/java/ajouter-un-certificat-pour-les-connexions-ssl-java.html">

    <header>
  
  <div class="logo">
	<a class="baselink" href="">
	    <img src="/images/logo.png" alt="wiki.ght1pc9kc.fr"/> wiki.ght1pc9kc.fr
	</a>
</div>
<span class="spacer">&nbsp;</span>
<div class="navbar-right">
    <form class="navbar-form navbar-left" action="/search.html" method="get">
       <input id="search-box" name="query" placeholder="Search..." autocomplete="off" spellcheck="false" dir="auto" type="text">
    </form>
</div>
</header>
<article>
  <aside class="menu">
    <div class="list-group">
        <a href="/cuisine.html" class="list-group-item list-group-item-action active">Cuisine</a>
    </div>
    <div class="list-group">
        <a href="/misc.html" class="list-group-item list-group-item-action active">Divers</a>
    </div>
    <div class="list-group">
        <a href="/development.html" class="list-group-item list-group-item-action active">Développement</a>
        <a href="/development/dotnet.html" class="list-group-item list-group-item-action ">.Net</a>
        <a href="/development/gwt.html" class="list-group-item list-group-item-action ">GWT</a>
        <a href="/development/java.html" class="list-group-item list-group-item-action ">Java</a>
        <a href="/development/javascript.html" class="list-group-item list-group-item-action ">Javascript</a>
        <a href="/development/spring.html" class="list-group-item list-group-item-action ">Spring</a>
    </div>
    <div class="list-group">
        <a href="/linux.html" class="list-group-item list-group-item-action active">Linux</a>
        <a href="/linux/administration.html" class="list-group-item list-group-item-action ">Administration</a>
        <a href="/linux/divers.html" class="list-group-item list-group-item-action ">Divers</a>
        <a href="/linux/gnomeshell.html" class="list-group-item list-group-item-action ">GnomeShell</a>
        <a href="/linux/network.html" class="list-group-item list-group-item-action ">Réseau</a>
        <a href="/linux/shell.html" class="list-group-item list-group-item-action ">Shell</a>
    </div>
    <div class="list-group">
        <a href="/outils.html" class="list-group-item list-group-item-action active">Outils</a>
        <a href="/outils/ansible.html" class="list-group-item list-group-item-action ">Ansible</a>
        <a href="/outils/docker.html" class="list-group-item list-group-item-action ">Docker</a>
        <a href="/outils/eclipse.html" class="list-group-item list-group-item-action ">Eclipse</a>
        <a href="/outils/git.html" class="list-group-item list-group-item-action ">Git</a>
        <a href="/outils/intellij.html" class="list-group-item list-group-item-action ">IntelliJ</a>
        <a href="/outils/latex.html" class="list-group-item list-group-item-action ">LaTeX</a>
        <a href="/outils/vmware.html" class="list-group-item list-group-item-action ">VMWare</a>
    </div>
    <div class="list-group">
        <a href="/serveurs.html" class="list-group-item list-group-item-action active">Serveur</a>
        <a href="/serveurs/http.html" class="list-group-item list-group-item-action ">HTTP</a>
        <a href="/serveurs/jboss.html" class="list-group-item list-group-item-action ">JBoss</a>
        <a href="/serveurs/mysql.html" class="list-group-item list-group-item-action ">MySQL</a>
        <a href="/serveurs/neo4j.html" class="list-group-item list-group-item-action ">Neo4J</a>
        <a href="/serveurs/oracle.html" class="list-group-item list-group-item-action ">Oracle</a>
        <a href="/serveurs/teradata.html" class="list-group-item list-group-item-action ">TeraData</a>
    </div>


  </aside>
  <section class="page">

    <h1>Ajouter un certificat pour les connexions SSL Java</h1>
    
    

    

<h2 id="symptôme">Symptôme</h2>

<p>Dans le cas par exemple d&rsquo;une connexion en LDAPS (LDAP via SSL) on a de bonne chance de se prendre ce genre d’erreur :</p>

<pre><code>javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
    at com.sun.net.ssl.internal.ssl.Alerts.getSSLException(Alerts.java:150)
    at com.sun.net.ssl.internal.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1584)
    at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:174)
    at com.sun.net.ssl.internal.ssl.Handshaker.fatalSE(Handshaker.java:168)
    at com.sun.net.ssl.internal.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:848)
    at com.sun.net.ssl.internal.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:106)
    at com.sun.net.ssl.internal.ssl.Handshaker.processLoop(Handshaker.java:495)
    at com.sun.net.ssl.internal.ssl.Handshaker.process_record(Handshaker.java:433)
    ...
</code></pre>

<p><em>Note que c’est la même pour les accès à des Web-Service en HTTPS via Axis</em></p>

<h2 id="explication">Explication</h2>

<p>Cette erreur vient du fait que le client n’accepte pas le certificat du serveur. Les histoires des certificats sont
manifestement un poil compliqué mais bon, grosso modo, il faut ajouter le certif du serveur à la politique sécurité
du client.</p>

<p>Sachant qu&rsquo;on parle du JRE utilisé par le serveur JBoss !</p>

<h2 id="solution-1">Solution 1</h2>

<p>Solution &ldquo;manuelle&rdquo;, testé chez La Poste et GMC. Les exemples donner sont sous Linux mais ça fonctionne de la même façon
sous Windows (j&rsquo;ai testé). La commande keytool est dans les binaire de java. Sous Windows elle est peut-être pas dans
le classpath.</p>

<p>En tant que &ldquo;root&rdquo;, exécuter la commande :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">keytool -importcert -keystore <span style="color:#e6db74">&#34;/usr/lib/jvm/java-6-sun/jre/lib/security/jssecacerts&#34;</span> -trustcacerts -alias <span style="color:#e6db74">&#34;nom.dusitequipublielecertif.fr&#34;</span> -file mon-certificat.cer</code></pre></div>
<p><em>Attention le chemin de le JRE est pas toujours le même ! Sous linux pour le connaître facilement taper:</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">update-alternatives --list java&lt;/code&gt;</code></pre></div>
<p>C&rsquo;est évident mais on sait jamais, s&rsquo;il y a plusieurs JRE sur le serveur, il faut exécuter sur celle qu&rsquo;utilise JBoss !!</p>

<p>La commande keytool devrait donner un truc du genre, le mot de passe est <strong>changeit</strong></p>

<pre><code>Tapez le mot de passe du Keystore :  
Ressaisissez le nouveau mot de passe : 
Propriétaire : CN=A10.blabla.test, L=PARIS, C=FR
Émetteur : CN=A10.blabla.test, L=PARIS, C=FR
Numéro de série : 9397247ec5cf9e4f
Valide du : Tue Jul 27 01:23:59 CEST 2010 au : Thu Jul 26 01:23:59 CEST 2012
Empreintes du certificat :
	 MD5 :  27:73:2E:FF:8F:AB:3A:2D:1F:47:42:A5:97:49:CF:74
	 SHA1 : 31:83:A1:FB:AE:69:91:F3:14:BF:5C:A8:67:2A:FD:CA:83:A6:5B:9A
	 Nom de l'algorithme de signature : MD5withRSA
	 Version : 4
Faire confiance à ce certificat ? [non] :  oui
Certificat ajouté au Keystore
</code></pre>

<p>Après les appels https sur le serveur dont vous venez d&rsquo;enregistrer le certificat devrait passer tout seul :p</p>

<h2 id="solution-2">Solution 2</h2>

<p>Donc le truc à faire c&rsquo;est d&rsquo;aller récupérer la classe <code>InstallCert.java</code> de la compiler puis de l&rsquo;exécuter avec en
paramètre le serveur que vous voulez accéder en SSL :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">javac -g InstallCert.java
java InstallCert your-ldap-server.somewhere.edu:636
cp jssecacerts $JAVA_HOME/lib/security</code></pre></div>
<p>En gros, on compile et on execute. Ca va créer un ~KeyStore dans &ldquo;jssecacerts&rdquo; et y placer le certificat de votre
serveur. Après, pour que le client appelé depuis Cameleon soit capable de retrouver ce certificat, il faut le placer
dans le ~KeyStore par défaut de la JRE utilisé par le serveur Cameleon.</p>

<p>Je vous invite vivement à vérifier le ~JAVA_HOME dans le .bat ou .sh de lancement de JBoss. Une fois que vous êtes sur
du JAVA_HOME, le ~KeyStore par défaut est dans ~JAVA_HOME/lib/security. Vous y recopiez le contenu de &ldquo;jssecacerts&rdquo;.</p>

<p>On redémarre le JBoss et hop ça fonctionne normalement !</p>

<h2 id="liens">Liens</h2>

<p>Par ordre d&rsquo;intérêt :</p>

<ul>
<li><a href="http://blogs.sun.com/andreas/entry/no_more_unable_to_find">http://blogs.sun.com/andreas/entry/no_more_unable_to_find</a></li>
<li><a href="http://www.google.com/support/forum/p/Google%20Apps/thread?tid=0b9d3f130628f63b&amp;hl=en">http://www.google.com/support/forum/p/Google%20Apps/thread?tid=0b9d3f130628f63b&amp;hl=en</a></li>
<li><a href="http://www.forumeasy.com/forums/archive/ldappro/200707/p118350434574.html">http://www.forumeasy.com/forums/archive/ldappro/200707/p118350434574.html</a></li>
</ul>

<!-- --- tags: crypto, java, security -->



    
    
  </section>

  
      <aside class="toc">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#symptôme">Symptôme</a></li>
<li><a href="#explication">Explication</a></li>
<li><a href="#solution-1">Solution 1</a></li>
<li><a href="#solution-2">Solution 2</a></li>
<li><a href="#liens">Liens</a></li>
</ul></li>
</ul>
</nav>
      </aside>
  

</article>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/js/search.js"></script>


    
    

    
  </body>
</html>
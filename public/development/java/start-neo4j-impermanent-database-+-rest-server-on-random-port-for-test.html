<!DOCTYPE html>
<html>
  <head>
    <title>
    Lancer Neo4j Impermanent Database &#43; REST Server sur un port aléatoire - wiki.ght1pc9kc.fr
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40.2" />
<title>Lancer Neo4j Impermanent Database &#43; REST Server sur un port aléatoire :: wiki.ght1pc9kc.fr</title>
<link rel="shortcut icon" href="/images/logo.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "";
</script>
  </head>
  <body data-url="/development/java/start-neo4j-impermanent-database-&#43;-rest-server-on-random-port-for-test.html">

    <header>
  
  <div class="logo">
	<a class="baselink" href="">
	    <img src="/images/logo.png" alt="wiki.ght1pc9kc.fr"/> wiki.ght1pc9kc.fr
	</a>
</div>
<span class="spacer">&nbsp;</span>
<div class="navbar-right">
    <form class="navbar-form navbar-left" action="/search.html" method="get">
       <input id="search-box" name="query" placeholder="Search..." autocomplete="off" spellcheck="false" dir="auto" type="text">
    </form>
</div>
</header>
<article>
  <aside class="menu">
    <div class="list-group">
        <a href="/cuisine.html" class="list-group-item list-group-item-action active">Cuisine</a>
    </div>
    <div class="list-group">
        <a href="/misc.html" class="list-group-item list-group-item-action active">Divers</a>
    </div>
    <div class="list-group">
        <a href="/development.html" class="list-group-item list-group-item-action active">Développement</a>
        <a href="/development/dotnet.html" class="list-group-item list-group-item-action ">.Net</a>
        <a href="/development/gwt.html" class="list-group-item list-group-item-action ">GWT</a>
        <a href="/development/java.html" class="list-group-item list-group-item-action ">Java</a>
        <a href="/development/javascript.html" class="list-group-item list-group-item-action ">Javascript</a>
        <a href="/development/spring.html" class="list-group-item list-group-item-action ">Spring</a>
    </div>
    <div class="list-group">
        <a href="/linux.html" class="list-group-item list-group-item-action active">Linux</a>
        <a href="/linux/administration.html" class="list-group-item list-group-item-action ">Administration</a>
        <a href="/linux/divers.html" class="list-group-item list-group-item-action ">Divers</a>
        <a href="/linux/gnomeshell.html" class="list-group-item list-group-item-action ">GnomeShell</a>
        <a href="/linux/network.html" class="list-group-item list-group-item-action ">Réseau</a>
        <a href="/linux/shell.html" class="list-group-item list-group-item-action ">Shell</a>
    </div>
    <div class="list-group">
        <a href="/outils.html" class="list-group-item list-group-item-action active">Outils</a>
        <a href="/outils/ansible.html" class="list-group-item list-group-item-action ">Ansible</a>
        <a href="/outils/docker.html" class="list-group-item list-group-item-action ">Docker</a>
        <a href="/outils/eclipse.html" class="list-group-item list-group-item-action ">Eclipse</a>
        <a href="/outils/git.html" class="list-group-item list-group-item-action ">Git</a>
        <a href="/outils/intellij.html" class="list-group-item list-group-item-action ">IntelliJ</a>
        <a href="/outils/latex.html" class="list-group-item list-group-item-action ">LaTeX</a>
        <a href="/outils/vmware.html" class="list-group-item list-group-item-action ">VMWare</a>
    </div>
    <div class="list-group">
        <a href="/serveurs.html" class="list-group-item list-group-item-action active">Serveur</a>
        <a href="/serveurs/http.html" class="list-group-item list-group-item-action ">HTTP</a>
        <a href="/serveurs/jboss.html" class="list-group-item list-group-item-action ">JBoss</a>
        <a href="/serveurs/mysql.html" class="list-group-item list-group-item-action ">MySQL</a>
        <a href="/serveurs/neo4j.html" class="list-group-item list-group-item-action ">Neo4J</a>
        <a href="/serveurs/oracle.html" class="list-group-item list-group-item-action ">Oracle</a>
        <a href="/serveurs/teradata.html" class="list-group-item list-group-item-action ">TeraData</a>
    </div>


  </aside>
  <section class="page">

    <h1>Lancer Neo4j Impermanent Database &#43; REST Server sur un port aléatoire</h1>
    
    

    <p>Pour des tests par exemple, vu que la licence Neo4j ne permet que l&rsquo;utilisation des API REST, on peut avoir besoin
lors de test de lancer un server éphémaire sur lequel brancher les jeux de test. Cela se fait en deux étapes :
 * Lancement du serveur neo4j
 * Lancement de la surcouche REST</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">db <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TestGraphDatabaseFactory<span style="color:#f92672">().</span><span style="color:#a6e22e">newImpermanentDatabase</span><span style="color:#f92672">();</span>

<span style="color:#66d9ef">boolean</span> available <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span><span style="color:#a6e22e">isAvailable</span><span style="color:#f92672">(</span>5000<span style="color:#f92672">);</span>
<span style="color:#66d9ef">assert</span> available<span style="color:#f92672">;</span>

<span style="color:#66d9ef">int</span> start <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">;</span>
Random random <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">();</span>
<span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>start <span style="color:#f92672">!=</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    port <span style="color:#f92672">=</span> RANDOM_PORTS_LOWER_BOUND <span style="color:#f92672">+</span> random<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">(</span>RANDOM_PORTS_COUNT<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        GraphDatabaseAPI api <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>GraphDatabaseAPI<span style="color:#f92672">)</span> db<span style="color:#f92672">;</span>
        ServerConfigurator config <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerConfigurator<span style="color:#f92672">(</span>api<span style="color:#f92672">);</span>
        config<span style="color:#f92672">.</span><span style="color:#a6e22e">configuration</span><span style="color:#f92672">().</span><span style="color:#a6e22e">addProperty</span><span style="color:#f92672">(</span>Configurator<span style="color:#f92672">.</span><span style="color:#a6e22e">WEBSERVER_ADDRESS_PROPERTY_KEY</span><span style="color:#f92672">,</span> NEO4J_EMBEDDED_HOST<span style="color:#f92672">);</span>
        config<span style="color:#f92672">.</span><span style="color:#a6e22e">configuration</span><span style="color:#f92672">().</span><span style="color:#a6e22e">addProperty</span><span style="color:#f92672">(</span>Configurator<span style="color:#f92672">.</span><span style="color:#a6e22e">WEBSERVER_PORT_PROPERTY_KEY</span><span style="color:#f92672">,</span> port<span style="color:#f92672">);</span>
        config<span style="color:#f92672">.</span><span style="color:#a6e22e">configuration</span><span style="color:#f92672">().</span><span style="color:#a6e22e">addProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;dbms.security.auth_enabled&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
        neoServerBootstrapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> WrappingNeoServerBootstrapper<span style="color:#f92672">(</span>api<span style="color:#f92672">,</span> config<span style="color:#f92672">);</span>
        start <span style="color:#f92672">=</span> neoServerBootstrapper<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        fail<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Unable to start neo4j test server !&#34;</span><span style="color:#f92672">,</span> e<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">graphFile</span> <span style="color:#f92672">=</span> graphFile<span style="color:#f92672">;</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Neo4jRestClient<span style="color:#f92672">(</span>NEO4J_EMBEDDED_HOST<span style="color:#f92672">,</span> port<span style="color:#f92672">,</span> NEO4J_EMBEDDED_PROTOCOL<span style="color:#f92672">);</span></code></pre></div>
<p>Il est a noter que les classes utilisées pour lancer le serveur REST sont dépréciés et sont sencés disparaitres
prochainement. Cela dit dans la derbière version testé (2.0.0) les classes sont toujours là et aucune solution
alternative n&rsquo;existe&hellip;</p>



    
    
  </section>

  
      <aside class="toc">
        
      </aside>
  

</article>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/js/search.js"></script>


    
    

    
  </body>
</html>
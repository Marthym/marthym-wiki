<!DOCTYPE html>
<html>
  <head>
    <title>
    Nettoyer les fichiers de configuration - wiki.ght1pc9kc.fr
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40.2" />
<title>Nettoyer les fichiers de configuration :: wiki.ght1pc9kc.fr</title>
<link rel="shortcut icon" href="/images/logo.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "";
</script>
  </head>
  <body data-url="/linux/administration/nettoyer-les-fichiers-de-configuration.html">

    <header>
  
  <div class="logo">
	<a class="baselink" href="">
	    <img src="/images/logo.png" alt="wiki.ght1pc9kc.fr"/> wiki.ght1pc9kc.fr
	</a>
</div>
<span class="spacer">&nbsp;</span>
<div class="navbar-right">
    <form class="navbar-form navbar-left" action="/search.html" method="get">
       <input id="search-box" name="query" placeholder="Search..." autocomplete="off" spellcheck="false" dir="auto" type="text">
    </form>
</div>
</header>
<article>
  <aside class="menu">
    <div class="list-group">
        <a href="/cuisine.html" class="list-group-item list-group-item-action active">Cuisine</a>
    </div>
    <div class="list-group">
        <a href="/misc.html" class="list-group-item list-group-item-action active">Divers</a>
    </div>
    <div class="list-group">
        <a href="/development.html" class="list-group-item list-group-item-action active">Développement</a>
        <a href="/development/dotnet.html" class="list-group-item list-group-item-action ">.Net</a>
        <a href="/development/gwt.html" class="list-group-item list-group-item-action ">GWT</a>
        <a href="/development/java.html" class="list-group-item list-group-item-action ">Java</a>
        <a href="/development/javascript.html" class="list-group-item list-group-item-action ">Javascript</a>
        <a href="/development/spring.html" class="list-group-item list-group-item-action ">Spring</a>
    </div>
    <div class="list-group">
        <a href="/linux.html" class="list-group-item list-group-item-action active">Linux</a>
        <a href="/linux/administration.html" class="list-group-item list-group-item-action ">Administration</a>
        <a href="/linux/divers.html" class="list-group-item list-group-item-action ">Divers</a>
        <a href="/linux/gnomeshell.html" class="list-group-item list-group-item-action ">GnomeShell</a>
        <a href="/linux/network.html" class="list-group-item list-group-item-action ">Réseau</a>
        <a href="/linux/shell.html" class="list-group-item list-group-item-action ">Shell</a>
    </div>
    <div class="list-group">
        <a href="/outils.html" class="list-group-item list-group-item-action active">Outils</a>
        <a href="/outils/ansible.html" class="list-group-item list-group-item-action ">Ansible</a>
        <a href="/outils/docker.html" class="list-group-item list-group-item-action ">Docker</a>
        <a href="/outils/eclipse.html" class="list-group-item list-group-item-action ">Eclipse</a>
        <a href="/outils/git.html" class="list-group-item list-group-item-action ">Git</a>
        <a href="/outils/intellij.html" class="list-group-item list-group-item-action ">IntelliJ</a>
        <a href="/outils/latex.html" class="list-group-item list-group-item-action ">LaTeX</a>
        <a href="/outils/vmware.html" class="list-group-item list-group-item-action ">VMWare</a>
    </div>
    <div class="list-group">
        <a href="/serveurs.html" class="list-group-item list-group-item-action active">Serveur</a>
        <a href="/serveurs/http.html" class="list-group-item list-group-item-action ">HTTP</a>
        <a href="/serveurs/jboss.html" class="list-group-item list-group-item-action ">JBoss</a>
        <a href="/serveurs/mysql.html" class="list-group-item list-group-item-action ">MySQL</a>
        <a href="/serveurs/neo4j.html" class="list-group-item list-group-item-action ">Neo4J</a>
        <a href="/serveurs/oracle.html" class="list-group-item list-group-item-action ">Oracle</a>
        <a href="/serveurs/teradata.html" class="list-group-item list-group-item-action ">TeraData</a>
    </div>


  </aside>
  <section class="page">

    <h1>Nettoyer les fichiers de configuration</h1>
    
    

    

<p>Au fil des mises à jours d&rsquo;une Debian, il arrive que des fichiers de configuration ne soient pas bien nettoyé. Il est parfois difficile dans les deb de supprimer des fichiers. Voilà comment trouver ces fichiers obsolète et les supprimer.</p>

<h2 id="procédure-standard">Procédure standard</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dpkg-query -W -f<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;${Conffiles}\n&#39;</span> | grep <span style="color:#e6db74">&#39;obsolete$&#39;</span>

 /etc/apparmor.d/abstractions/evince ae2a1e8cf5a7577239e89435a6ceb469 obsolete
 /etc/apparmor.d/tunables/ntpd 5519e4c01535818cb26f2ef9e527f191 obsolete
 /etc/apparmor.d/usr.bin.evince 08a12a7e468e1a70a86555e0070a7167 obsolete
 /etc/apparmor.d/usr.sbin.ntpd a00aa055d1a5feff414bacc89b8c9f6e obsolete
 /etc/bash_completion.d/initramfs-tools 7eeb7184772f3658e7cf446945c096b1 obsolete
 /etc/bash_completion.d/insserv 32975fe14795d6fce1408d5fd22747fd obsolete
 /etc/dbus-1/system.d/com.redhat.NewPrinterNotification.conf 8df3896101328880517f530c11fff877 obsolete
 /etc/dbus-1/system.d/com.redhat.PrinterDriversInstaller.conf d81013f5bfeece9858706aed938e16bb obsolete</code></pre></div>
<p>L&rsquo;idée est ensuite de trouver à quel package appatiennent ces fichiers puis de supprimer le fichier et demander une reconfiguration du package en question :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dpkg -S /etc/bash_completion.d/initramfs-tools
initramfs-tools: /etc/bash_completion.d/initramfs-tools
dpkg -S /etc/bash_completion.d/insserv
initramfs-tools: /etc/bash_completion.d/insserv</code></pre></div>
<p>Donc nos fichiers initramfs-tools et insserv appartiennent à initramfs-tools.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rm /etc/bash_completion.d/initramfs-tools /etc/bash_completion.d/insserv
apt install --reinstall initramfs-tools insserv</code></pre></div>
<p>Et voilà.</p>

<p>Malheureusement, ça ne fonctionne pas pour tous les types de fichier, ça serait trop facile.</p>

<h2 id="les-fichiers-dbus-1">Les fichiers dbus-1</h2>

<p>Pour je ne sais quelle raison, ça ne fonctionne pas avec les fichiers présent dans <code>/etc/dbus-1/system.d/</code>, il faut alors ré-installer les packages correspondant.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dpkg -S /etc/dbus-1/system.d/com.redhat.NewPrinterNotification.conf
  system-config-printer-common: /etc/dbus-1/system.d/com.redhat.NewPrinterNotification.conf
dpkg -S /etc/dbus-1/system.d/com.redhat.PrinterDriversInstaller.conf
  system-config-printer-common: /etc/dbus-1/system.d/com.redhat.PrinterDriversInstaller.conf

apt purge system-config-printer-common
apt install system-config-printer</code></pre></div>
<p>Inutile de les supprimer à la main.</p>

<h2 id="les-fichiers-apparmor">Les fichiers Apparmor</h2>

<p>Et biensûr les fichiers apparmor pausent aussi des problèmes. Purger le package qui les installe ne change rien du tout. Il semble qu&rsquo;il faille aussi purger les profils apparmor.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt purge apparmor-profiles apparmor-profiles-extra evince ntp
apt install apparmor-profiles apparmor-profiles-extra evince ntp</code></pre></div>
<p>Rq: Pourquoi <code>evince</code> et <code>ntp</code> sont de la partie. Je sais pas, François Marier suspecte que ces fichiers sont livré pour l&rsquo;un des package apparmor mais qu&rsquo;ils sont finalement migré par <code>evince</code> ou <code>ntp</code> eux même et que du coup <code>dpkg</code> s&rsquo;emmèle les pinceaux.</p>

<h2 id="liens">Liens</h2>

<ul>
<li><a href="https://feeding.cloud.geek.nz/posts/cleaning-up-obsolete-config-files-debian-ubuntu/">https://feeding.cloud.geek.nz/posts/cleaning-up-obsolete-config-files-debian-ubuntu/</a></li>
</ul>



    
    
  </section>

  
      <aside class="toc">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#procédure-standard">Procédure standard</a></li>
<li><a href="#les-fichiers-dbus-1">Les fichiers dbus-1</a></li>
<li><a href="#les-fichiers-apparmor">Les fichiers Apparmor</a></li>
<li><a href="#liens">Liens</a></li>
</ul></li>
</ul>
</nav>
      </aside>
  

</article>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/js/search.js"></script>


    
    

    
  </body>
</html>
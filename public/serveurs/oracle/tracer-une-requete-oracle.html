<!DOCTYPE html>
<html>
  <head>
    <title>
    Tracer une requête Oracle - wiki.ght1pc9kc.fr
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.40.2" />
<title>Tracer une requête Oracle :: wiki.ght1pc9kc.fr</title>
<link rel="shortcut icon" href="/images/logo.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "";
</script>
  </head>
  <body data-url="/serveurs/oracle/tracer-une-requete-oracle.html">

    <header>
  
  <div class="logo">
	<a class="baselink" href="">
	    <img src="/images/logo.png" alt="wiki.ght1pc9kc.fr"/> wiki.ght1pc9kc.fr
	</a>
</div>
<span class="spacer">&nbsp;</span>
<div class="navbar-right">
    <form class="navbar-form navbar-left" action="/search.html" method="get">
       <input id="search-box" name="query" placeholder="Search..." autocomplete="off" spellcheck="false" dir="auto" type="text">
    </form>
</div>
</header>
<article>
  <aside class="menu">
    <div class="list-group">
        <a href="/cuisine.html" class="list-group-item list-group-item-action active">Cuisine</a>
    </div>
    <div class="list-group">
        <a href="/misc.html" class="list-group-item list-group-item-action active">Divers</a>
    </div>
    <div class="list-group">
        <a href="/development.html" class="list-group-item list-group-item-action active">Développement</a>
        <a href="/development/dotnet.html" class="list-group-item list-group-item-action ">.Net</a>
        <a href="/development/gwt.html" class="list-group-item list-group-item-action ">GWT</a>
        <a href="/development/java.html" class="list-group-item list-group-item-action ">Java</a>
        <a href="/development/javascript.html" class="list-group-item list-group-item-action ">Javascript</a>
        <a href="/development/spring.html" class="list-group-item list-group-item-action ">Spring</a>
    </div>
    <div class="list-group">
        <a href="/linux.html" class="list-group-item list-group-item-action active">Linux</a>
        <a href="/linux/administration.html" class="list-group-item list-group-item-action ">Administration</a>
        <a href="/linux/divers.html" class="list-group-item list-group-item-action ">Divers</a>
        <a href="/linux/gnomeshell.html" class="list-group-item list-group-item-action ">GnomeShell</a>
        <a href="/linux/network.html" class="list-group-item list-group-item-action ">Réseau</a>
        <a href="/linux/shell.html" class="list-group-item list-group-item-action ">Shell</a>
    </div>
    <div class="list-group">
        <a href="/outils.html" class="list-group-item list-group-item-action active">Outils</a>
        <a href="/outils/ansible.html" class="list-group-item list-group-item-action ">Ansible</a>
        <a href="/outils/docker.html" class="list-group-item list-group-item-action ">Docker</a>
        <a href="/outils/eclipse.html" class="list-group-item list-group-item-action ">Eclipse</a>
        <a href="/outils/git.html" class="list-group-item list-group-item-action ">Git</a>
        <a href="/outils/intellij.html" class="list-group-item list-group-item-action ">IntelliJ</a>
        <a href="/outils/latex.html" class="list-group-item list-group-item-action ">LaTeX</a>
        <a href="/outils/vmware.html" class="list-group-item list-group-item-action ">VMWare</a>
    </div>
    <div class="list-group">
        <a href="/serveurs.html" class="list-group-item list-group-item-action active">Serveur</a>
        <a href="/serveurs/http.html" class="list-group-item list-group-item-action ">HTTP</a>
        <a href="/serveurs/jboss.html" class="list-group-item list-group-item-action ">JBoss</a>
        <a href="/serveurs/mysql.html" class="list-group-item list-group-item-action ">MySQL</a>
        <a href="/serveurs/neo4j.html" class="list-group-item list-group-item-action ">Neo4J</a>
        <a href="/serveurs/oracle.html" class="list-group-item list-group-item-action ">Oracle</a>
        <a href="/serveurs/teradata.html" class="list-group-item list-group-item-action ">TeraData</a>
    </div>


  </aside>
  <section class="page">

    <h1>Tracer une requête Oracle</h1>
    
    

    

<p>Il arrive qu&rsquo;une partie de l&rsquo;appli (voire toute l&rsquo;appli) rame particulièrement. Selon la version d&rsquo;Oracle, il est plus
ou moins facile de tracer une requête. Dans tout les cas, il peut arrivé qu&rsquo;on est besoin d&rsquo;un maximum d&rsquo;info.</p>

<h2 id="oracle-10g-et-entreprise-manager">Oracle 10g et Entreprise Manager</h2>

<p>Sur un serveur 10g, le plus simple est d&rsquo;ouvrir l&rsquo;entreprise manager et de cliquer sur l&rsquo;onglet performances. De là,
sous le graphique, un lien &ldquo;Sessions les plus consommatrices&hellip;&rdquo; qui permet de visualiser les requêtes et les sessions
les plus gourmandes.</p>

<h2 id="oracle-8i-et-9i">Oracle 8i et 9i</h2>

<p>Dans ces versions, on n&rsquo;a pas les outils de la 10g et la recherche s&rsquo;avère plus compliqué. La solution la plus simple
est de tracer les sessions (voire toute la base). Pour cela, voilà la marche à suivre. L&rsquo;intérêt de cette procédure un
peu lourde est qu&rsquo;il n&rsquo;est pas nécessaire de redémarrer l&rsquo;instance et la trace ne s&rsquo;applique que sur une seule session.</p>

<p>Déjà, faut trouver la session qui va bien :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> sid, serial<span style="color:#f92672">#</span> <span style="color:#66d9ef">from</span> v$session <span style="color:#66d9ef">where</span> username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CCS43&#39;</span>;</code></pre></div>
<p>S&rsquo;il y en a plusieurs, on peut filtrer sur des champs comme PROGRAM ou MACHINE.</p>

<p>Ensuite on vide le répertoire de trace du serveur, en général <code>ORACLE_HOME/admin/ORCL/udump</code></p>

<p>Puis on démarre la trace sur la session :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">exec</span> DBMS_SYSTEM.SET_SQL_TRACE_IN_SESSION (sid<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">507</span>, serial<span style="color:#f92672">#=&gt;</span><span style="color:#ae81ff">4957</span>,sql_trace<span style="color:#f92672">=&gt;</span><span style="color:#66d9ef">TRUE</span>);</code></pre></div>
<p>On lance les requêtes que l&rsquo;on veut tracer ou on va dans la partie de l&rsquo;appli qui rame.</p>

<p>On récupère le fichier <code>.trc</code> généré dans le répertoire de trace</p>

<p>On arrête la trace :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">exec</span> DBMS_SYSTEM.SET_SQL_TRACE_IN_SESSION (sid<span style="color:#f92672">=&gt;</span><span style="color:#ae81ff">507</span>, serial<span style="color:#f92672">#=&gt;</span><span style="color:#ae81ff">4957</span>,sql_trace<span style="color:#f92672">=&gt;</span><span style="color:#66d9ef">FALSE</span>);<span style="color:#f92672">&lt;/</span>code<span style="color:#f92672">&gt;</span></code></pre></div>
<p>On tkprof le fichier TRC pour avoir un truc lisible.</p>

<p>PS : On peut aussi exécuter un</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SQL</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">alter</span> <span style="color:#66d9ef">system</span> <span style="color:#66d9ef">set</span> timed_statistics <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>;</code></pre></div>
<p>Cela va permettre de connaitre les temps de réponse d&rsquo;oracle, le temps de parsing ou d&rsquo;exécution de chaque requête. Ca
permet lors du tkprof de trier par temps d&rsquo;exécution pour avoir les plus grosse requêtes en haut du fichier.</p>

<h2 id="liens">Liens</h2>

<ul>
<li><a href="http://alexzeng.wordpress.com/2008/08/01/how-to-trace-oracle-sessions/">http://alexzeng.wordpress.com/2008/08/01/how-to-trace-oracle-sessions/</a></li>
<li><a href="http://www.oradev.com/create_statistics.jsp">http://www.oradev.com/create_statistics.jsp</a></li>
</ul>



    
    
  </section>

  
      <aside class="toc">
        <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#oracle-10g-et-entreprise-manager">Oracle 10g et Entreprise Manager</a></li>
<li><a href="#oracle-8i-et-9i">Oracle 8i et 9i</a></li>
<li><a href="#liens">Liens</a></li>
</ul></li>
</ul>
</nav>
      </aside>
  

</article>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/js/search.js"></script>


    
    

    
  </body>
</html>